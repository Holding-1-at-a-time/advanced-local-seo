{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/advanced-local-seo/app/api/email/send/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { google } from \"googleapis\"\n\n// Gmail API configuration\nconst oauth2Client = new google.auth.OAuth2(\n  process.env.GOOGLE_CLIENT_ID,\n  process.env.GOOGLE_CLIENT_SECRET,\n  process.env.GOOGLE_REDIRECT_URI,\n)\n\noauth2Client.setCredentials({\n  refresh_token: process.env.GOOGLE_REFRESH_TOKEN,\n})\n\nconst gmail = google.gmail({ version: \"v1\", auth: oauth2Client })\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { to, toName, subject, html } = await request.json()\n\n    if (!to || !subject || !html) {\n      return NextResponse.json({ message: \"Missing required fields: to, subject, html\" }, { status: 400 })\n    }\n\n    // Create the email message in RFC 2822 format\n    const emailLines = [\n      `To: ${toName ? `\"${toName}\" <${to}>` : to}`,\n      `From: \"One Detail At A Time\" <${process.env.GMAIL_SENDER_EMAIL}>`,\n      `Subject: ${subject}`,\n      \"MIME-Version: 1.0\",\n      'Content-Type: text/html; charset=\"UTF-8\"',\n      \"\",\n      html,\n    ]\n\n    const email = emailLines.join(\"\\r\\n\")\n\n    // Encode the email in base64url format\n    const encodedEmail = Buffer.from(email)\n      .toString(\"base64\")\n      .replace(/\\+/g, \"-\")\n      .replace(/\\//g, \"_\")\n      .replace(/=+$/, \"\")\n\n    // Send the email via Gmail API\n    const response = await gmail.users.messages.send({\n      userId: \"me\",\n      requestBody: {\n        raw: encodedEmail,\n      },\n    })\n\n    return NextResponse.json({\n      success: true,\n      messageId: response.data.id,\n    })\n  } catch (error) {\n    console.error(\"[v0] Gmail API error:\", error)\n    return NextResponse.json(\n      {\n        message: error instanceof Error ? error.message : \"Failed to send email\",\n      },\n      { status: 500 },\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,0BAA0B;AAC1B,MAAM,eAAe,IAAI,wNAAM,CAAC,IAAI,CAAC,MAAM,CACzC,QAAQ,GAAG,CAAC,gBAAgB,EAC5B,QAAQ,GAAG,CAAC,oBAAoB,EAChC,QAAQ,GAAG,CAAC,mBAAmB;AAGjC,aAAa,cAAc,CAAC;IAC1B,eAAe,QAAQ,GAAG,CAAC,oBAAoB;AACjD;AAEA,MAAM,QAAQ,wNAAM,CAAC,KAAK,CAAC;IAAE,SAAS;IAAM,MAAM;AAAa;AAExD,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,IAAI;QAExD,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,MAAM;YAC5B,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA6C,GAAG;gBAAE,QAAQ;YAAI;QACpG;QAEA,8CAA8C;QAC9C,MAAM,aAAa;YACjB,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC,EAAE,OAAO,GAAG,EAAE,GAAG,CAAC,CAAC,GAAG,IAAI;YAC5C,CAAC,8BAA8B,EAAE,QAAQ,GAAG,CAAC,kBAAkB,CAAC,CAAC,CAAC;YAClE,CAAC,SAAS,EAAE,SAAS;YACrB;YACA;YACA;YACA;SACD;QAED,MAAM,QAAQ,WAAW,IAAI,CAAC;QAE9B,uCAAuC;QACvC,MAAM,eAAe,OAAO,IAAI,CAAC,OAC9B,QAAQ,CAAC,UACT,OAAO,CAAC,OAAO,KACf,OAAO,CAAC,OAAO,KACf,OAAO,CAAC,OAAO;QAElB,+BAA+B;QAC/B,MAAM,WAAW,MAAM,MAAM,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC;YAC/C,QAAQ;YACR,aAAa;gBACX,KAAK;YACP;QACF;QAEA,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,WAAW,SAAS,IAAI,CAAC,EAAE;QAC7B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,+QAAY,CAAC,IAAI,CACtB;YACE,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}